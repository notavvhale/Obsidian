# Инструкция моя

Качаем [эмулятор](https://disk.yandex.ru/d/utY1Ha3RcBANeQ)
Качаем [VirtualBox](https://www.virtualbox.org/wiki/Downloads) потому что hyper-v не поддерживает .ova

Импортируем машину
![[Pasted image 20260205132625.png]]Ставим такие настройки чтобы был доступен во всей сети.
Адаптер нужно выбрать который использует ПК.
![[Pasted image 20260205132840.png]]
Если не нужно пробрасывать во всю сеть, VirtualBox создаёт виртуальный адаптер. Выбираем его и настраиваем static ip в свойствах адаптера.
![[Pasted image 20260205133039.png]]![[Pasted image 20260205133228.png]]
По настройкам гипервизора - всё. Запускаем ВМ.
![[Pasted image 20260205133452.png]]Логин: ruboard
Пароль: ruboard

![[Pasted image 20260205133551.png]]
Попадаем в панель управления. В случае подключения по виртуальному адаптеру, эмпирическим путём находим настройки сети. Они находятся в Система>Сеть. Задаём ip той же подсети что указывали в адаптере виртуальном. Если основной сетевой адаптер, то используем DHCP и ниче делать не надо. Всё работает с коробки.

Дальше переходим в основную систему. Открываем
haspemul.4.6.1\VirtualHere Client 5.9.3\vhui64.
![[Pasted image 20260205134148.png]]
И видим наш сервер USB. Если сервер не видно - нужно проверять сетевые настройки либо основной машины, либо гипервизора либо ВМ.

Итак, чтобы эти ключи начали работать выбираем либо весь сервер либо нужный ключ > ПКМ > Auto-Use Device. Для того чтобы VirtualHere запускался автоматически > ПКМ по USB Servers > Install Client as a Service.
![[Pasted image 20260206170625.png]]

# Инструкция из readme
Называется haspemul.
HASPEMUL 4.6.1 (17.09.2025)
Виртуальная машина для раздачи ключей 1С на базе Debian 10 x86

https://forum.ru-board.com/topic.cgi?forum=35&topic=83057
Обсуждение установки, работы, ошибок и предложений. А также дополнения и инструкции.

Пользователи: ruboard/ruboard, root/ruboard
Внутри набор дампов ключей:
- серверные x86, x64
- клиентские на 1,5,10,20,50,100,300,500
По умолчанию активны 2 ключа: x64 и Net-100
Все настройки выполняются через Панель управления
Знания линукс не обязательны
Панель управления запускается при авторизации или "sudo control"

Потребление памяти:
- до Оптимизации памяти HASPEMUL рекомендуется запускать на не менее 256 Мб
- после выполнения Оптимизации памяти объем оперативной памяти может быть понижен до 128 Мб и ниже
Настройки зависят от используемого гипервизора
Оптимизации памяти настраивается во встроенной Панели управления.

Особенности настройки на некоторых гипервизорах:
- VirtualBox (Win11) - установить 2 процессора
- Hyper-V - Поколение 1 + виртуальных процессоров 1

Особенности доступа к сетевой папке с серверных ОС Windows Server:
Для доступа к сетевой папке необходимо в настройках Сетевая папка (SMB) добавить пользователя
с тем же логином и паролем, что и пользователь Windows Server.

Порядок настройки в клиент-серверном режиме:
1. На сервер 1С нужно прокинуть 2 ключа (серверный и клиентский) с помощью USB Redirector или VirtualHere
2. Установить драйвера на появившиеся USB устройства, если не встали (Установка драйвера защиты)
3. После установки драйвера защиты может потребоваться перезагрузка компьютера
4. На сервере включить "Разрешить выдачу лицензий сервером 1С: Предприятия" в настройках Информационной базы.
5. В настройках клиента 1С (где запускается 1С) отключить "Использовать аппаратную лицензию (ключ защиты)"
 
Порядок настройки в файловом режиме (вариант 1):
*только для локальных компьютеров (по RDP работать не будет)
6. Прокинуть только 1 клиентский ключ с помощью USB Redirector или VirtualHere
7. Установить драйвера на появившиеся USB устройства, если не встали (Установка драйвера защиты)
8. После установки драйвера защиты может потребоваться перезагрузка компьютера
9. В настройках клиента 1С (где запускается 1С) включить "Использовать аппаратную лицензию (ключ защиты)"
 
Порядок настройки в файловом режиме (вариант 2):
*работает по RDP, но только с сетевыми ключами
10. На виртуальной машине положить клиентский ключ в контейнер и включить HASP LM
11. Настроить nethasp.ini на клиенте 1С (где запускается 1С) с указанием ip адреса виртуальной машины
12. В настройках клиента 1С (где запускается 1С) включить "Использовать аппаратную лицензию (ключ защиты)"
 
Настройки HASPEMUL:
13. Подключение к ВМ и авторизация
Подключиться к ВМ можно непосредственно через окно ВМ на гипервизоре, так и удаленно через протокол SSH.
При первом запуске подключаемся через окно ВМ на гипервизоре. Вводим логин и пароль пользователя "ruboard".
После авторизации появится меню Панели управления ВМ.
После настройки сети к ВМ можно также подключаться удаленно через SSH, для чего
можно использовать connect.bat или бесплатную утилиту PuTTY.
 
14. Настройка сети (соответствующий раздел в Панели управления)
В верхней строке раздела отображается IP-адрес ВМ. При первом входе адрес может не отображаться, т.к. сеть ещё не настроена.
а) Настройка DHCP. Получать IP-адрес автоматически от DHCP-сервера. Например, ВМ может получить IP-адрес от роутера.
б) Настройка Статический адрес. Настроить сетевые настройки вручную с указаним постоянного IP-адреса.
Статический адрес указывается в формате CIDR - XXX.XXX.XXX.XXX/XX (подробную информацию можно найти в интернете)
Если не знаете как настраивается статический адрес, попробуйте для начала использовать DHCP.
Имейте ввиду, что IP-адрес, полученный через DHCP, в дальнейшем может изменяться и это не всегда удобно.
 
15. Эмулятор (соответствующий раздел в Панели управления)
В данном разделе можно настроить свой набор дампов ключей из встроенного комплекта или своих.
Дампы ключей собираются в контейнеры, в каждый из которых можно положить до 7 штук.
Контейнеры запускаются на отдельных USB-шинах. Номера шин присваиваются в порядке запуска контейнеров.
Чтобы загрузить собственные дампы, их нужно предварительно положить в сетевую папку \\IP\ruboard (\\haspemul\ruboard)
или через SSH загрузить в папку /home/ruboard. Загружать дампы можно в двух форматах .reg и .json.
Дампы в формате .reg предварительно конвертируются в .json через встроенный конвертер reg2json.
 
16. HASP License Manager (соответствующий раздел в Панели управления)
Менеджер лицензий HASP LM выдаёт клиентские лицензии 1С по сети. Может быть использован для запуска с файловыми базами.
"Использование лицензий" отображает информацию о подключенном ключе к HASP LM и количестве занятых лицензий.
Через HASP LM могут передаваться:
- 1 ключ из серии ORGL8 (ключи net5, net10, net20, net50, net100)
- 1 ключ из серии ORG8A (net250+ ключ на 300 клиентов)
- 1 ключ из серии ORG8B (net250+ ключ на 500 клиентов)
Ключ в каждой серии выбирается случайный. Дампы, добавленные в USB Redirector, HASP LM не раздает.
 
5. VirtualHere & USB Redirector (соответствующие разделы в Панели управления)
Позволяют пробрасывать USB устройства с ВМ на любой другой компьютер. С помощью данных средств можно прокинуть сами USB-ключи.
В комплекте идут программы-клиенты под Windows.
Особенности:
- VirtualHere не требуется предварительной настройки на ВМ кроме активации (запускается при первой загрузке).
Лицензия VirtualHere включает пробрасывание до 63 USB-устройств. Все настройки выполняются на стороне клиента.
- USB Redirector требует предварительно настроить доступ к конкретным USB-устройствам.
Либо включить автоматический доступ, тогда ко всем USB-устройства будет сразу открываться доступ, кроме списка исключения.
К устройствам с открытым доступом закрывается доступ остальных программ, в том числе HASP LM, что удобно
использовать для совместного их использования. Клиент USB Redirector укомплектован ключем на 10 подключений.
 
6. Сетевая папка (SMB) (соответствующий раздел в Панели управления)
Позволяет управлять сетевой папкой для загрузки дампов и обновлений ВМ.
!! Для доступа к сетевой папке с ОС Windows Server необходимо в настройках ВМ добавить пользователя с тем же
логином и паролем, что и пользователь Windows Server.
 
7. Управление памятью (соответствующий раздел в Панели управления)
Отображает информацию о количестве используемой и свободной оперативной памяти.
Также есть возможность сократить количество используемой оперативной памяти за счет некоторой оптимизации.
Подробнее в инструкции "Как минимизировать количество используемой оперативной памяти".

Ещё инструкции здесь
https://forum.ru-board.com/topic.cgi?forum=35&topic=83057
